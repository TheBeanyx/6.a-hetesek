<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>6.A Hetesek - Felhaszn√°l√≥i regisztr√°ci√≥</title>
  <link rel="icon" href="data:," />
  <style>
    body{font-family:"Segoe UI",Tahoma,sans-serif;background:#0a0f1a;color:#fff;padding:20px;}
    h1,h2{color:#00f6ff;}
    input{padding:10px;margin:5px 0;border-radius:6px;border:none;width:100%;}
    .btn{background:#00f6ff;padding:10px 20px;border:none;border-radius:6px;color:#000;font-weight:600;cursor:pointer;margin:5px 0;}
    .btn:hover{background:#00c8d6;}
    .user-box{background:#111a;padding:10px;margin:10px 0;border-radius:8px;display:flex;justify-content:space-between;align-items:center;}
    .clipboard{cursor:pointer;margin-left:10px;color:#0ff;}
    #message-box{background:#28a745;padding:10px;border-radius:6px;margin:10px 0;display:none;}
  </style>
</head>
<body>

  <h1>Regisztr√°ci√≥ ‚Äì 6.A Hetesek</h1>

  <div id="reg-form">
    <input type="text" id="first-name" placeholder="Keresztn√©v">
    <input type="text" id="last-name" placeholder="Vezet√©kn√©v">
    <input type="password" id="password" placeholder="Jelsz√≥">
    <input type="password" id="password2" placeholder="Jelsz√≥ meger≈ës√≠t√©se">
    <button id="register-btn" class="btn">Regisztr√°ci√≥</button>
  </div>

  <div id="message-box"></div>

  <h2>Regisztr√°lt felhaszn√°l√≥k</h2>
  <div id="users-list">Bet√∂lt√©s...</div>

  <!-- Firebase 9 modulok -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, set, get, onValue, push } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBKkH5fTCZ4HprZ8KOIxkxdgVRfOIUw3-M",
      authDomain: "hetesek6a.firebaseapp.com",
      databaseURL: "https://hetesek6a-users-default-rtdb.firebaseio.com", // k√ºl√∂n DB regisztr√°lt felhaszn√°l√≥knak
      projectId: "hetesek6a-users",
      storageBucket: "hetesek6a-users.appspot.com",
      messagingSenderId: "62186380462",
      appId: "1:62186380462:web:a3c54df5d96d4c9ec0213f"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const msgBox = document.getElementById("message-box");
    const usersList = document.getElementById("users-list");

    function showMessage(text, success=true){
      msgBox.textContent = text;
      msgBox.style.background = success ? "#28a745" : "#d9534f";
      msgBox.style.display = "block";
      setTimeout(()=>msgBox.style.display="none", 3000);
    }

    function generateUsername(first, last){
      const random = Math.floor(100+Math.random()*900);
      return `${first.toLowerCase()}_${last.toLowerCase()}${random}`;
    }

    function renderUsers(){
      get(ref(db, "users")).then(snap=>{
        if(!snap.exists()){usersList.innerHTML="Nincs felhaszn√°l√≥.";}
        else {
          const data = snap.val();
          usersList.innerHTML = "";
          Object.values(data).forEach(user=>{
            const div = document.createElement("div");
            div.classList.add("user-box");
            div.innerHTML = `<span>${user.username}</span>
                             <span class="clipboard">üìã</span>`;
            const clip = div.querySelector(".clipboard");
            clip.onclick = ()=>{navigator.clipboard.writeText(user.username); showMessage("Felhaszn√°l√≥n√©v a v√°g√≥lapra m√°solva!");}
            usersList.appendChild(div);
          });
        }
      });
    }

    renderUsers();

    document.getElementById("register-btn").onclick = ()=>{
      const first = document.getElementById("first-name").value.trim();
      const last = document.getElementById("last-name").value.trim();
      const pass1 = document.getElementById("password").value;
      const pass2 = document.getElementById("password2").value;

      if(!first || !last || !pass1 || !pass2){showMessage("T√∂lts ki minden mez≈ët!",false); return;}
      if(pass1 !== pass2){showMessage("A jelszavak nem egyeznek!",false); return;}

      const username = generateUsername(first, last);

      const newUserRef = push(ref(db, "users"));
      set(newUserRef, {username: username, password: pass1})
        .then(()=>{showMessage(`Sikeres regisztr√°ci√≥! Felhaszn√°l√≥n√©v: ${username}`); renderUsers();})
        .catch(err=>showMessage("Hiba t√∂rt√©nt: "+err.message,false));
    };
  </script>
</body>
</html>
