<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>6.A Hetesek - Firebase</title>
  <link rel="icon" href="data:," />
  <style>
    :root{--bg1:#0a0f1a;--bg2:#1c2a48;--accent:#00f6ff;--accent-2:#00c8d6;}
    body{margin:0;font-family:"Segoe UI",Tahoma,sans-serif;background:linear-gradient(135deg,var(--bg1),var(--bg2));color:#fff;display:flex;flex-direction:column;align-items:center;padding:20px;min-height:100vh;box-sizing:border-box;}
    h1{margin:18px 0 6px;font-size:clamp(1.8rem,5vw,3rem);color:var(--accent);text-shadow:0 0 14px rgba(0,246,255,0.15);}
    .leaderboard{width:100%;max-width:760px;background:rgba(34,34,34,0.92);border-radius:18px;padding:20px;box-shadow:0 8px 30px rgba(0,246,255,0.06);box-sizing:border-box;text-align:center;font-size:1.3rem;}
    .name-box{margin-top:20px;padding:16px;border-radius:12px;background:#111a;font-size:1.4rem;font-weight:600;letter-spacing:0.5px;box-shadow:0 8px 20px rgba(0,246,255,0.05);}
    .date-box{margin-top:12px;font-size:1.1rem;opacity:0.9;}
    #login-icon{position:fixed;top:14px;right:14px;font-size:1.9rem;background:transparent;border:none;color:var(--accent);cursor:pointer;z-index:999;}
    .modal {display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);justify-content:center;align-items:center;z-index:1000;}
    .modal-content {background:#1c1c1c;padding:20px;border-radius:12px;width:90%;max-width:400px;color:white;text-align:center;}
    .modal input {width:90%;padding:10px;margin:8px 0;border-radius:8px;border:none;}
    .btn {background:var(--accent);padding:10px 20px;border:none;border-radius:8px;font-size:1rem;cursor:pointer;margin:6px;}
    .btn:hover {background:var(--accent-2);}
    #admin-panel {display:none;margin-top:20px;padding:20px;background:#111a;border-radius:12px;max-width:600px;width:100%;}
    .admin-user-row {background:#222;padding:10px;margin:6px 0;border-radius:8px;display:flex;justify-content:space-between;align-items:center;}
    .admin-user-row button {margin-left:4px;padding:6px 10px;border-radius:6px;}
    #login-info {margin-top:20px;padding:12px 20px;background:#111a;border-radius:12px;display:none;font-size:1.1rem;}
    #message-box {position: fixed;bottom: 20px;left: 50%;transform: translateX(-50%);background: #28a745;padding: 14px 24px;border-radius: 10px;color: white;font-size: 1.1rem;display: none;box-shadow: 0 8px 20px rgba(0,0,0,0.3);z-index: 2000;animation: fadeIn 0.3s ease;}
    @keyframes fadeIn {from { opacity: 0; transform: translateX(-50%) translateY(10px); } to { opacity: 1; transform: translateX(-50%) translateY(0); }}
    .clip-icon {cursor:pointer; margin-left:8px; color:#00f6ff;}
  </style>
</head>
<body>

  <button id="login-icon">üîë</button>
  <h1>6.A oszt√°ly ‚Äì Hetesek</h1>
  <div class="leaderboard">
    <div class="date-box" id="date-box"></div>
    <div class="name-box" id="names"></div>
    <button id="next-week-btn" class="btn" style="display:none;margin-top:15px;">K√∂vetkez≈ë hetes ‚ûú</button>
  </div>
  <div id="login-info"></div>

  <div id="auth-modal" class="modal">
    <div class="modal-content">
      <h2>Bejelentkez√©s</h2>
      <input id="login-user" placeholder="Felhaszn√°l√≥n√©v">
      <input id="login-pass" type="password" placeholder="Jelsz√≥">
      <button id="login-btn" class="btn">Bel√©p√©s</button>
      <hr>
      <h3>Regisztr√°ci√≥</h3>
      <input id="reg-first" placeholder="Keresztn√©v">
      <input id="reg-last" placeholder="Vezet√©kn√©v">
      <input id="reg-pass1" type="password" placeholder="Jelsz√≥">
      <input id="reg-pass2" type="password" placeholder="Jelsz√≥ meger≈ës√≠t√©se">
      <button id="reg-btn" class="btn">Regisztr√°ci√≥</button>
      <div id="new-username" style="margin-top:12px;"></div>
      <br>
      <button id="close-modal" class="btn" style="background:#555;">Bez√°r√°s</button>
    </div>
  </div>

  <div id="admin-panel">
    <h2>Admin Panel</h2>
    <div id="user-list"></div>
  </div>

  <div id="message-box"></div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <script>
    // üîπ F≈ë Firebase ‚Äì heti lista
    const firebaseConfig = {
      apiKey: "API_KEY",
      authDomain: "PROJECT_ID.firebaseapp.com",
      databaseURL: "https://PROJECT_ID-default-rtdb.firebaseio.com",
      projectId: "PROJECT_ID",
      storageBucket: "PROJECT_ID.appspot.com",
      messagingSenderId: "SENDER_ID",
      appId: "APP_ID"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // üîπ Hetes lista
    const hetesLista = [
      ["√Årp√°si Panni","Bert√≥k M√°rton"],
      ["Buz√°s Benedek","Egenhoffer-V√©gh Edvard"],
      ["Gamble Elenor Mae","Guardado Alexander Joaquin"],
      ["Hazuga K√°roly","Hegyh√°ti Roz√°lia"],
      ["Hommonay M√°rton","Kiss Triszt√°n"],
      ["K√∂r√∂ssy Gr√©ti","Laki Johanna"],
      ["Marczali Dion","Papp M√°rton"],
      ["Par√°di Nimr√≥d","Radics T√≠mea"],
      ["R√©v√©sz Barnab√°s","Staudt M√°rk"],
      ["Tokai-Barak M√°rk","Szab√≥ Fl√≥ra"],
      ["V√°mosi-Nagy Szonja","Vit√°ri M√°ty√°s"]
    ];

    const namesBox = document.getElementById("names");
    function renderHetes(index){ const [n1,n2] = hetesLista[index]; namesBox.textContent = `${n1} √©s ${n2}`; }

    function renderWeekRange(){
      const now = new Date(); const day = now.getDay()||7;
      const monday=new Date(now); monday.setDate(now.getDate()-(day-1));
      const friday=new Date(monday); friday.setDate(monday.getDate()+4);
      const f=d=>d.toLocaleDateString("hu-HU",{year:"numeric",month:"long",day:"numeric"});
      document.getElementById("date-box").textContent=`${f(monday)} ‚Äì ${f(friday)}`;
    }
    renderWeekRange();

    // üîπ User management
    let loggedInUser = null;
    const superadmin = {user:"benedek_buzas13", pass:"Benedek11", admin:true};
    const usersRef = db.ref("users");
    const hetesIndexRef = db.ref("hetesIndex");

    usersRef.child(superadmin.user).set(superadmin);

    function showMessage(text,success=true){
      const box=document.getElementById("message-box");
      box.textContent=text; box.style.background=success?"#28a745":"#d9534f";
      box.style.display="block"; setTimeout(()=>box.style.display="none",2500);
    }

    function updateLoginInfo(){
      const box=document.getElementById("login-info");
      if(!loggedInUser){box.style.display="none"; return;}
      box.style.display="block";
      box.innerHTML=`Bejelentkezve: <b>${loggedInUser.user}</b>
        <button id="logout-btn" class="btn" style="margin-left:15px;">Kijelentkez√©s</button>`;
      document.getElementById("logout-btn").onclick=()=>{loggedInUser=null; updateLoginInfo(); document.getElementById("next-week-btn").style.display="none";}
    }

    const modal=document.getElementById("auth-modal");
    document.getElementById("login-icon").onclick=()=>modal.style.display="flex";
    document.getElementById("close-modal").onclick=()=>modal.style.display="none";

    hetesIndexRef.on("value",snap=>{ if(snap.exists()){renderHetes(snap.val());} else {hetesIndexRef.set(0);} });

    document.getElementById("next-week-btn").onclick=()=>{ hetesIndexRef.transaction(c=> (c===null?0:c+1)%hetesLista.length ); };

    document.getElementById("login-btn").onclick=()=>{
      let u=document.getElementById("login-user").value.trim();
      let p=document.getElementById("login-pass").value.trim();
      usersRef.child(u).get().then(snap=>{
        if(!snap.exists()||snap.val().pass!==p){showMessage("Hib√°s adatok!",false);return;}
        loggedInUser=snap.val(); modal.style.display="none"; updateLoginInfo();
        if(loggedInUser.admin) document.getElementById("next-week-btn").style.display="inline-block";
      });
    };

    // üîπ M√°sodik Firebase ‚Äì regisztr√°lt felhaszn√°l√≥k
    const regFirebaseConfig = {
      apiKey: "AIzaSyCn3leDSuRAYYN4RdMtvU3XBlrR4P4_vWk",
      authDomain: "hetesek-6a-registeredusers.firebaseapp.com",
      databaseURL: "https://hetesek-6a-registeredusers-default-rtdb.firebaseio.com",
      projectId: "hetesek-6a-registeredusers",
      storageBucket: "hetesek-6a-registeredusers.firebasestorage.app",
      messagingSenderId: "221961476284",
      appId: "1:221961476284:web:08d2b42f7b3ab44bd458b9",
      measurementId: "G-NY90K40DWD"
    };
    const regApp = firebase.initializeApp(regFirebaseConfig, "regApp");
    const regDb = regApp.database().ref();

    document.getElementById("reg-btn").onclick=()=>{
      const fn=document.getElementById("reg-first").value.trim();
      const ln=document.getElementById("reg-last").value.trim();
      const p1=document.getElementById("reg-pass1").value.trim();
      const p2=document.getElementById("reg-pass2").value.trim();
      if(!fn||!ln||!p1||!p2){showMessage("T√∂lts ki minden mez≈ët!",false); return;}
      if(p1!==p2){showMessage("A jelszavak nem egyeznek!",false); return;}
      const rnd=Math.floor(Math.random()*1000);
      const uname=`${fn.toLowerCase()}_${ln.toLowerCase()}${rnd}`;
      regDb.child("registeredUsers").child(uname).set({user:uname, pass:p1}).then(()=>{
        showMessage("Sikeres regisztr√°ci√≥!");
        const div=document.getElementById("new-username");
        div.innerHTML=`<b>Felhaszn√°l√≥n√©v:</b> ${uname} <span class="clip-icon" onclick="navigator.clipboard.writeText('${uname}')">üìã</span>`;
      }).catch(err=>showMessage("Hiba t√∂rt√©nt: "+err,false));
    };
  </script>

</body>
</html>
